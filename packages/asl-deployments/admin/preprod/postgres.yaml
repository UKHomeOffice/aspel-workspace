apiVersion: v1
kind: Pod
metadata:
  name: postgres-client
spec:
  containers:
    - name: tools
      image: quay.io/ukhomeofficedigital/postgres-client:latest
      resources:
        limits:
          cpu: 50m
          memory: 512Mi
        requests:
          cpu: 50m
          memory: 256Mi
      securityContext:
        runAsNonRoot: true
        runAsUser: 70
      command: [ "/bin/sh", "-c", "--" ]
      args: [ "while true; do sleep 30; done;" ]
      env:
        - name: PGHOST
          valueFrom:
            secretKeyRef:
              name: asl-preprod-rds
              key: endpoint
        - name: PGPORT
          valueFrom:
            secretKeyRef:
              name: asl-preprod-rds
              key: port
        - name: PGUSER
          valueFrom:
            secretKeyRef:
              name: asl-preprod-rds
              key: username
        - name: PGPASSWORD
          valueFrom:
            secretKeyRef:
              name: asl-preprod-rds
              key: password
        - name: PGDATABASE
          valueFrom:
            secretKeyRef:
              name: asl-preprod-rds
              key: db_name
        - name: WORKFLOW_HOST
          valueFrom:
            secretKeyRef:
              name: asl-preprod-workflow-rds
              key: endpoint
        - name: WORKFLOW_PORT
          valueFrom:
            secretKeyRef:
              name: asl-preprod-workflow-rds
              key: port
        - name: WORKFLOW_USERNAME
          valueFrom:
            secretKeyRef:
              name: asl-preprod-workflow-rds
              key: username
        - name: WORKFLOW_PASSWORD
          valueFrom:
            secretKeyRef:
              name: asl-preprod-workflow-rds
              key: password
        - name: WORKFLOW_DATABASE
          valueFrom:
            secretKeyRef:
              name: asl-preprod-workflow-rds
              key: default_db
        - name: PASSWORD_PUBLICAPI
          valueFrom:
            secretKeyRef:
              name: dbpasswords
              key: publicapi
        - name: PASSWORD_INTERNALAPI
          valueFrom:
            secretKeyRef:
              name: dbpasswords
              key: internalapi
        - name: PASSWORD_WORKFLOW
          valueFrom:
            secretKeyRef:
              name: dbpasswords
              key: workflow
        - name: PASSWORD_RESOLVER
          valueFrom:
            secretKeyRef:
              name: dbpasswords
              key: resolver
        - name: PASSWORD_PERMISSIONS
          valueFrom:
            secretKeyRef:
              name: dbpasswords
              key: permissions
        - name: PASSWORD_NOTIFICATIONS
          valueFrom:
            secretKeyRef:
              name: dbpasswords
              key: notifications
      ports:
        - containerPort: 8080
          name: toolset
